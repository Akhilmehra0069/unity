<apex:page showHeader="false" sideBar="false" controller="CommunityGroupDetailPageController" standardStylesheets="false" docType="html-5.0" applyBodyTag="false" applyHtmlTag="false">
<apex:composition template="{!$Site.Template}">
<apex:define name="title">{!$Label.LBL_Page_Title}</apex:define>
<apex:define name="body">
	<style>
		.profile-edit .headline { margin-bottom: 15px; }
		.profile-edit .blog-photos li img { width: 36px; height: 36px; }
		.modal-open { padding-right: 0px !important; }
	</style>

	<!--=== Breadcrumbs ===-->
	<div class="breadcrumbs margin-bottom-10">
		<div class="container">
			<h1 class="pull-left">{!control.Name}</h1>
			<ul class="pull-right breadcrumb">
				<li><a href="{!$Page.CommunityHome}">Home</a></li>
				<li><a href="{!$Page.CommunityGroups}">{!$Label.LBL_Groups}</a></li>
				<li class="active">{!control.Name}</li>
			</ul>
		</div><!--/container-->
	</div><!--/breadcrumbs-->
	<!--=== End Breadcrumbs ===-->

	<apex:outputPanel layout="block" styleClass="profile">
		<apex:outputPanel layout="block" styleClass="content container">
			<apex:outputPanel layout="block" styleClass="row">

				<!--Left Sidebar-->
				<div class="col-md-3 md-margin-bottom-20">
					<div class="chatter-photo"><c:CommunityUserPhoto current="false" photoUrl="{!chatterGroup.FullPhotoUrl}" fmode="true"/></div>
					<c:CommunityFeedNavigation currentGroupId="{!chatterGroup.Id}" pn="5"/>
				</div>
				<!--End Left Sidebar-->

				<!-- Center -->
				<div class="col-md-7 md-margin-bottom-20">
					<div id="feed" class="profile-edit">
						<c:CommunityFeed pid="{!chatterGroup.Id}"/>
					</div>
				</div>
				<!-- End Center -->

				<!-- Right Sidebar-->
				<div class="col-md-2 md-margin-bottom-20 profile-edit">
					<apex:form >
						<apex:outputPanel id="btnaction">
							<button type="button" class="btn btn-u{!ActionButton.btnStyle} btn-xs" onclick="chckabtn('{!ActionButton.action}');return false;" title="{!ActionButton.title}">
								<i class="fa {!ActionButton.btnIcon}"></i>
								&nbsp;{!ActionButton.btnLabel}
							</button>
						</apex:outputPanel>
						<script>
							function chckabtn(a) {
								if (a != '0') {
									var fa = true;
									if (a == '1' || a == '2') {
										fa = confirm('{!$Label.LBL_LeaveGroup_Message}');
									}
									else if (a == '5') {
										fa = confirm('{!$Label.LBL_CancelRequest_Message}');
									}
									if (fa) {
										pgmsha(a);
										$('[id$=btnaction] i').attr('class','fa fa-spinner fa-pulse');
									}
								}
							}
						</script>
						<apex:actionFunction action="{!performGroupMembershipAction}" name="pgmsha" rerender="btnaction, crevlink">
							<apex:param name="par" assignTo="{!groupMode}" value=""/>
						</apex:actionFunction>
					</apex:form>
					<div class="headline"><h4>{!$Label.LBL_Members}</h4></div>
					<ul class="list-unstyled blog-photos">
						<apex:repeat value="{!members.users}" var="member">
							<li>
								<a href="{!$Page.CommunityProfilePage}?id={!member.id}">
									<img class="hover-effect" src="{!member.photourl}" title="{!member.name}{!IF(ISBLANK(member.role),'', ' (' + member.role + ')')}"/>
								</a>
							</li>
						</apex:repeat>
					</ul>
					<div class="margin-bottom-20">
						<a href="#newConversationModal" role="button" data-toggle="modal">
							<span id="moreGroupMembersLink">{!$Label.LBL_Show_All} ({!members.totalUsers})</span>
						</a>
					</div>
					<div class="blog-twitter">
						<div class="headline"><h4>{!$Label.LBL_Upcoming_Events}</h4></div>
						<apex:outputPanel id="crevlink" layout="block" styleClass="margin-bottom-5">
							<apex:outputLink value="{!UrlForCreateEvent}" rendered="{!showCreateEvent}">{!$Label.BTN_Create_Event}</apex:outputLink>
						</apex:outputPanel>
						<apex:repeat value="{!Events}" var="ev">
							<div class="blog-twitter-inner">
								<a href="{!$Page.CommunityEventDetail}?id={!ev.id}">{!ev.name}</a> 
								<span class="twitter-time">{!ev.ftime}</span>
							</div>
						</apex:repeat>
						<apex:outputPanel layout="block" styleClass="tag-box tag-box-v6" rendered="{!Events.size == 0}">
							<p>{!$Label.LBL_No_Upcoming_Events_Group}</p>
						</apex:outputPanel>
					</div>
				</div>
				<!-- End Right Sidebar-->
			</apex:outputPanel>
			<!--/end row-->
		</apex:outputPanel>
		<!--/container-->
	</apex:outputPanel>
	<div class="modal fade" id="newConversationModal" tabindex="-1" role="dialog" aria-labelledby="newConversationModalLabel" aria-hidden="true" style="display: none;">
		<div class="modal-dialog">
			<apex:form id="memlist" styleClass="modal-content sky-form">
				<div class="modal-header">
					<button aria-hidden="true" data-dismiss="modal" class="close" type="button">&times;</button>
					<h4 id="newConversationModalLabel" class="modal-title">{!$Label.LBL_Group_Members}</h4>
				</div>
				<div class="modal-body" id="groupmembermodal">
					<table class="table table-hover" id="groupmembertable">
						<apex:repeat value="{!members.users}" var="mmbr" id="membermodal">
							<tr>
								<td width="50px">
									<a href="{!$Page.CommunityProfilePage}?id={!mmbr.id}">
										<apex:image styleClass="rounded-x" style="margin-top: 0px; margin-bottom: 0px" url="{!mmbr.photourl}" width="50px" height="50px"/>
									</a>
								</td>
								<td>
									<div class="name-location">
										<a href="{!$Page.CommunityProfilePage}?id={!mmbr.id}">
											<strong>{!mmbr.name}</strong>
										</a><br/>
										<span>{!mmbr.role}</span>
									</div>
								</td>
								<td class="text-right">
									<apex:outputPanel layout="none" rendered="{!mmbr.follow && mmbr.id != $User.Id}">
										<button id="{!mmbr.id}" type="button" class="btn btn-u btn-u-blue" onclick="toogleFollowing('{!mmbr.id}');return false;">
											<i class="fa fa-check"></i>
											&nbsp;{!$Label.BTN_Following}
										</button>
									</apex:outputPanel>
									<apex:outputPanel layout="none" rendered="{!!mmbr.follow && mmbr.id != $User.Id}">
										<button id="{!mmbr.id}" type="button" class="btn btn-u" onclick="toogleFollowing('{!mmbr.id}');return false;">
											<i class="fa fa-plus-circle"></i>
											&nbsp;{!$Label.LBL_Follow}
										</button>
									</apex:outputPanel>
								</td>
							</tr>
						</apex:repeat>
						<script>
							function toogleFollowing(inid) {
								Visualforce.remoting.Manager.invokeAction(
									'CommunityGroupDetailPageController.toggleSubscriber',
									inid,
									function(result, event) {}
								);
								if ($('#' + inid + '.btn-u-blue').length == 0) {
									$('#' + inid).addClass('btn-u-blue').html('<i class="fa fa-check"></i>&nbsp;{!$Label.BTN_Following}');
									$('#' + inid + ' i').attr('class','fa fa-check');
								}
								else {
									$('#' + inid).removeClass('btn-u-blue').html('<i class="fa fa-plus-circle"></i>&nbsp;{!$Label.LBL_Follow}');
								}
							}
						</script>
						<apex:outputPanel layout="none" rendered="{!members.showPagination}">
							<tr>
								<td>&nbsp;</td>
								<td class="">
									<apex:outputPanel style="cursor: pointer;">
										<apex:actionSupport event="onclick" action="{!members.firstPage}" rendered="{!members.hasPrevious}" rerender="memlist"/>
										<apex:image value="/s.gif" styleClass="{!IF(members.hasPrevious,'first','firstoff')}"/>
									</apex:outputPanel>
									&nbsp;
									<apex:outputPanel style="cursor: pointer;">
										<apex:actionSupport event="onclick" action="{!members.previousPage}" rendered="{!members.hasPrevious}" rerender="memlist"/>
										<apex:image value="/s.gif" styleClass="{!IF(members.hasPrevious,'prev','prevoff')}"/>
										<apex:outputText value="{!$Label.LBL_Previous}" styleClass="{!IF(members.hasPrevious,'','prevNextLinks')}"/>
									</apex:outputPanel>
									&nbsp;&nbsp;
									<apex:outputPanel style="cursor: pointer;">
										<apex:actionSupport event="onclick" action="{!members.nextPage}" rendered="{!members.hasNext}" rerender="memlist"/>
										<apex:outputText value="{!$Label.LBL_Next}" styleClass="{!IF(members.hasNext,'','prevNextLinks')}"/>
										<apex:image value="/s.gif" styleClass="{!IF(members.hasNext,'next','nextoff')}"/>
									</apex:outputPanel>
									&nbsp;
									<apex:outputPanel style="cursor: pointer;">
										<apex:actionSupport event="onclick" action="{!members.lastPage}" rendered="{!members.hasNext}" rerender="memlist"/>
										<apex:image value="/s.gif" styleClass="{!IF(members.hasNext,'last','lastoff')}"/>
									</apex:outputPanel>
								</td>
								<td>
									<apex:outputText value="{!$Label.LBL_Page} {!members.pageNumber} {!$Label.LBL_of} {!members.totalPages}"/>
								</td>
							</tr>
						</apex:outputPanel>
					</table>
				</div>
				<div class="modal-footer">
					<button data-dismiss="modal" type="button" class="button btn-u-default" id="closeDialogButton" value="Close" title="Close">Close</button>
				</div>
			</apex:form>
		</div>
	</div>
</apex:define>
</apex:composition>
</apex:page>